<!DOCTYPE html>
<html>

<head>
    <title>XO</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
    <script src="https://kit.fontawesome.com/5c58c1fd4e.js"></script>
</head>

<body>
</body>
<script type="text/javascript" src="./Classes/class.Map.js"></script>
<script type="text/javascript" src="./Classes/class.Game.js"></script>
<script type="text/javascript" src="./Classes/class.Player.js"></script>
<script type="text/javascript" src="./Classes/class.MapCreator.js"></script>
<script type="text/javascript" src="./index.js"></script>
<!-- <script type="text/javascript">

class Player {
    constructor(point) {
        this.point = point // X or O
    }

    get getPoint() {
        return this.point
    }

    setPoint(map, field, point) {
        map.setState(field, point)
    }
}

class MapCreator {

    constructor(mapName, fieldsId, size) {
        this.mapId = fieldsId
        this.mapName = mapName
        this.size = size
    }

    get getMapId() {
        return this.mapId
    }

    get getMapName() {
        return this.mapName
    }

    domCreateMap() {
        let bodyElement = document.querySelector('body')

        let mainContainerDiv = document.createElement('div')
        mainContainerDiv.id = this.mapName
        mainContainerDiv.className = "container col-9"


        let headerDiv = document.createElement('div')
        headerDiv.className = "col-12"
        headerDiv.style = "text-align: center;"
        headerDiv.textContent = "TIC TAC TOE"

        let bodyDiv = document.createElement('div')
        bodyDiv.className = 'col-12'

        mainContainerDiv.appendChild(headerDiv)

        //create row and col fields 
        for (let i = 0; i < this.size; i++) {
            let rowDiv = document.createElement('div')
            rowDiv.className = 'row'
            rowDiv.style = "justify-content: center;position: relative;"


            for (let j = 0; j < this.size; j++) {
                let colDiv = document.createElement('div')
                colDiv.className = 'col-2 ' + this.mapId
                colDiv.style = "height: 150px;border: 1px solid;text-align: center;font-size: 6em;"

                rowDiv.appendChild(colDiv);
            }
            bodyDiv.appendChild(rowDiv)

        }
        mainContainerDiv.appendChild(bodyDiv)
        bodyElement.appendChild(mainContainerDiv)
    }


}


class Map {

    map = undefined; // 1d vector fields
    mapCreator = undefined; // 1d vector fields

    createMap(mapCreator) {
        this.map = document.querySelectorAll('.' + mapCreator.getMapId)
    }

    setState(field, point) {
        if (field.textContent == "") {
            field.innerHTML = point
            field.style.backgroundColor = "lightgreen"
        } else {
            return "This field closed by " + field.textContent
        }
    }


    isWinCombination() {

        function CheckX(e) {
            return e.textContent == "X"
        }

        function CheckO(e) {
            return e.textContent == "O"
        }

        //width the map (3 fields)
        let map = this.map
        let mapWidth = Math.sqrt(this.map.length)

        //horizontal check comb
        for (let i = 0; i < map.length; i += mapWidth) {

            let horizontalSlice = Array.from(map).slice(i, i + mapWidth)

            if (horizontalSlice.every(CheckX) || horizontalSlice.every(CheckO)) {
                return true;
            }

        }

        //vertical check comb
        for (let i = 0; i < mapWidth; i++) {
            let buf = []

            // push to buf vertical fields
            for (let j = 0; j < map.length; j += mapWidth) {

                buf[buf.length] = map[i + j]
            }

            if (buf.every(CheckX) || buf.every(CheckO)) {
                return true
            };
        }

        //  \ diagonal check comb
        var buf = []

        for (let i = 0; i < map.length; i += (mapWidth + 1)) {
            buf[buf.length] = map[i]
        }

        if (buf.every(CheckX) || buf.every(CheckO)) {
            return true
        };


        //  / diagonal check comb
        var buf = []

        for (let i = mapWidth - 1; i < map.length - 1; i += (mapWidth - 1)) {
            buf[buf.length] = map[i]
        }

        if (buf.every(CheckX) || buf.every(CheckO)) {
            return true
        };
    }
}



class Game {
    constructor(map_Creator, player_1, player_2) {
        this.player1 = player_1
        this.player2 = player_2
        this.mapCreator = map_Creator
        this.mapCreator.domCreateMap()
    }

    gameProcess() {
        var map = new Map()
        map.createMap(this.mapCreator)

        let player1 = this.player1
        let player2 = this.player2


        let switchTurnTo = undefined; //value = player1.point || player2.point
        switchTurnTo = player1.getPoint

        let mapName = this.mapCreator.getMapName

        let gameField = document.querySelector("#" + mapName)


        gameField.addEventListener('click', e => {

            let field = e.target
            let mapId = this.mapCreator.getMapId
            if (switchTurnTo == player1.getPoint && field.className == ("col-2 " + mapId)) {

                player1.setPoint(map, field, player1.point)

                if (map.isWinCombination()) {
                    alert("WIN: X")
                    let result = confirm("lets play again?");
                    if (result) {
                        window.location.reload();
                    }
                } else {
                    switchTurnTo = player2.point
                }

            } else if (switchTurnTo == player2.point && field.className == "col-2 " + mapId) {
                player2.setPoint(map, field, player2.point)
                if (map.isWinCombination()) {
                    alert("WIN: O")
                    let result = confirm("lets play again?");
                    if (result) {
                        window.location.reload();
                    }
                } else {
                    switchTurnTo = player1.point
                }

            }
        })

    }
}



var play1 = new Player("X")
var play2 = new Player("O")
var mapCreator = new MapCreator("game1", "map1", 3)
var game = new Game(mapCreator, play1, play2);
game.gameProcess()





var play3 = new Player("X")
var play4 = new Player("O")
var mapCreator1 = new MapCreator("game2", "map2", 3)
var game1 = new Game(mapCreator1, play3, play4);
game1.gameProcess()

</script> -->
<script src="https://kit.fontawesome.com/5c58c1fd4e.js"></script>
<script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</html>